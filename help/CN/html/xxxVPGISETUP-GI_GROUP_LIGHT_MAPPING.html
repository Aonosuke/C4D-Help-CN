<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- saved from url=(0014)about:internet -->
<html>

	<head>
		<meta http-equiv="content-type" content="text/html;charset=utf-8">
		<meta name="generator" content="WICKIE">
		<title>GI Setup: Light Mapping</title>
		<meta name="FORMATTER" content="wickie">
		<link href="../../files/wickie.css" type="text/css" rel="stylesheet" media="all">
		<script type="text/javascript" src="../../files/versionAppender.js"> </script>
		<script type="text/javascript" src="../../files/linkRewriter.js"> </script> 
		<!--PAGE_ID "52459"-->
		<!--VATER_ID "32075"-->
		<!--REIHENFOLGE "5"-->
		<!--TITLE "GI Setup: Light Mapping"-->
		<!--APPS "16 14 15 10 11"-->
		<!--TYP "GROUP"-->
	</head>

<body bgcolor="#e0e0e0" link="black" vlink="#2a2a2a">


<!--NO_SEARCH_START-->
<span class="link_back"><a href="1001.html" target="_self">CINEMA 4D Prime</a></span> <span class="link_back"><a href="5697.html" target="_self">Render Menu</a></span> <span class="link_back"><a href="DRENDERSETTINGS.html" target="_self">Edit Render Settings</a></span> <span class="link_back"><a href="32219.html" target="_self">Global Illumination</a></span> <span class="link_back"><a href="VPGISETUP.html" target="_self">GI Setup</a></span>

<div class="in-prime-page in-visualize-page in-broadcast-page in-studio-page in-bodypaint3d-page ">  <div class="page_only_body">
<div class="page_only_apps">             Function available in CINEMA 4D Prime, Visualize, Broadcast, Studio & BodyPaint 3D  </div>
<span class="HL_atom"><a href="VPGISETUP.html">GI Setup</a> </span><p></p><a href="VPGISETUP-GI_GROUP_GENERAL.html" target=""><span class="c4d_group_navi">General</span></a> <a href="VPGISETUP-GI_GROUP_IC2.html" target=""><span class="c4d_group_navi">Irradiance Cache</span></a> <a href="VPGISETUP-GI_GROUP_IRRADIANCE.html" target=""><span class="c4d_group_navi">Irradiance Cache (Legacy)</span></a> <a href="VPGISETUP-GI_GROUP_RADIANCE.html" target=""><span class="c4d_group_navi">Radiosity Maps</span></a> <a href="VPGISETUP-GI_GROUP_LIGHT_MAPPING.html" target=""><span class="c4d_group_navi_self">Light Mapping</span></a> <a href="VPGISETUP-GI_GROUP_CACHES.html" target=""><span class="c4d_group_navi">Cache Files</span></a> <a href="VPGISETUP-GI_GROUP_OPTIONS.html" target=""><span class="c4d_group_navi">Options</span></a><!--NO_SEARCH_END--><p class="c4d_group"><span>Light Mapping</span></p><p></p>
<p><PAGE_RELEASE_150 New GI method Light Mapping></p>
<p><a id="hl_1" name="hl_1"></a><!--INDEX "3","General","hl_1"--><p><span class="HL_1">General</span></p>
<p>Simply stated, the Light Mapping method works as follows: A series of samples are emitted into the scene from the angle of view of the camera. These samples are often reflected (depending on the <span class="command">Maximum Depth</span> value and if the sample doesn’t first strike the sky or nothing at all) and the colors that are calculated when geometry is struck will be evaluated. Entire sample chains result, which can be calculated very quickly (also for high numbers of reflections) and in consideration of other sample chains - faster than all other GI methods. The calculated colors are saved in a cell pattern (alternatively as a file, if desired, which can be re-used later) and then made available using the <span class="command">Primary Method</span>, which itself uses the Light Map with a sample depth greater than <span class="command_value">1</span> when gathering light (samples).</p>
<p>Note that the rendered image will more often be brighter due to the high sample depth, which is higher than that of other GI methods; This can be compensated for by reducing the <a href="VPGISETUP-GI_GROUP_GENERAL.html#GI_SETUP_DATA_SECONDARY_INTENSITY" target="_self"><span class="text_id">Intensity</span></a> value.</p>
<p>This method has both advantages and disadvantages:</p>
<p>Advantages:<ul></p>
<p><li> Very fast GI calculation (with very high sample depths)</li><li> Light Maps can be saved and re-used to a certain degree (these are dependent on the angle of view)</li>Disadvantages:</p>
<p><li> Light leaks can occur (these can be minimized by reducing the <a href="VPGISETUP-GI_GROUP_LIGHT_MAPPING.html#GI_SETUP_DATA_LIGHT_MAPPING_PATH_SCALE_SCREEN" target="_self"><span class="text_id">Samples Size</span></a> value and by not using interpolation. Using thicker objects instead of single polygon surfaces also helps).</li></ul><p></p>
<p><a id="hl_2" name="hl_2"></a><!--INDEX "3","Settings","hl_2"--><p><span class="HL_1">Settings</span></p>
<p>First, we will take a look at what a good Light Map looks like (you can make a Light Map visible by setting <a href="VPGISETUP-GI_GROUP_LIGHT_MAPPING.html#GI_SETUP_DATA_LIGHT_MAPPING_MODE" target="_self"><span class="text_id">Mode</span></a> to <nobr><span class="text_id_cycle">Visualize</span></nobr>):</p>
<p><div class="image_full" style="max-width:1646px"><img  src="../pics/037318.jpg"  ><span class="caption"></span></div></p>
<p>At the top left and top right are poor and better quality Light Maps, respectively. Good Light Maps have a homogenous light progression; in contrast, Light Maps with poor quality appear inhomogenous. When rendered, the difference is not as apparent because the <span class="command">Primary Method</span> samples the Light Map with numerous samples and produces median values. Nevertheless, the <span class="command">Primary Method</span> will only deliver sub-optimal results even with the best settings if the Light Map that was initially calculated was of poor quality. This can be seen at the bottom left of the image in which flickering occurs in the regions around the window and beneath the left ball.</p>
<p>In the <span class="command">Prefilter</span> and <span class="command">Interpolation Method</span> settings you will find functions that can be used to remove the cell pattern and for smoothing (both render very fast) in order to achieve the most homogenous light dispersion possible.</p>
<p>See also <a href="32220.html#lm" target="">Optimize Light Maps</a> for avoiding light leaks.</p>
<p><a id="GI_SETUP_DATA_LIGHT_MAPPING_PATH_COUNT" name="GI_SETUP_DATA_LIGHT_MAPPING_PATH_COUNT"></a> <!--INDEX "8","Path Count (x1000)","GI_SETUP_DATA_LIGHT_MAPPING_PATH_COUNT"--><span class="c4d_id">Path Count (x1000)</span> <span class="range">[1..100000]</span></p>
<p><div class="image_full" style="max-width:1000px"><img  src="../pics/037319.jpg"  ><span class="caption">Left smaller, right larger <span class="command">Path Count (1000s)</span> values.</span></div></p>
<p>Next to the <span class="command">Record Density</span> setting, <span class="command">Path Count (1000s)</span> is the most important setting for adjusting Light Map quality.</p>
<p>The <span class="command">Path Count (1000s)</span> value (which is multiplied internally by 1000) defines the number of samples that should be calculated for the entire scene. A sample chain with a depth corresponding to the <span class="command">Maximum Depth</span> value will be generated.</p>
<p>The higher the number, the more homogenous the light dispersion will be and the longer the corresponding render times will be - more samples will be used per cell element and the random color divergence (at the top of the image, a sample coincidentally strikes a black seam) of neighboring cells will be smaller.</p>
<p><a id="GI_SETUP_DATA_LIGHT_MAPPING_PATH_SCALE_SCREEN" name="GI_SETUP_DATA_LIGHT_MAPPING_PATH_SCALE_SCREEN"></a> <!--INDEX "8","Samples Size","GI_SETUP_DATA_LIGHT_MAPPING_PATH_SCALE_SCREEN"--><span class="c4d_id">Samples Size</span> <span class="range">[0.001..1]</span><br><a id="GI_SETUP_DATA_LIGHT_MAPPING_PATH_SCALE_WORLD" name="GI_SETUP_DATA_LIGHT_MAPPING_PATH_SCALE_WORLD"></a> <!--INDEX "8","Samples Size","GI_SETUP_DATA_LIGHT_MAPPING_PATH_SCALE_WORLD"--><span class="c4d_id">Samples Size</span> <span class="range">[0.001..100000m]</span></p>
<p><div class="image_full" style="max-width:1600px"><img  src="../pics/037320.jpg"  ><span class="caption">Left larger, right smaller <span class="command">Sample Size</span> values.</span></div></p>
<p>Use these values to define the cell size. The smaller the cells, the more accurate the result will be with regard to details. Cells that are too large will quickly lead to light leaks and are overall less precise with regard to details, i.e., shadows will be lost here and there. Depending on the <span class="command">Scale</span> defined, <span class="command">Sample Size</span> can be defined as absolute (<span class="command_value">World</span>) or relative (<span class="command_value">Screen</span>).</p>
<p><a id="GI_SETUP_DATA_LIGHT_MAPPING_PATH_SCALE_MODE" name="GI_SETUP_DATA_LIGHT_MAPPING_PATH_SCALE_MODE"></a> <!--INDEX "8","Scale","GI_SETUP_DATA_LIGHT_MAPPING_PATH_SCALE_MODE"--><span class="c4d_id">Scale</span></p>
<p>You can select from the following options:<ul></p>
<p><li> <span class="command">World</span>: The <span class="command">Sample Size</span> values can be output as absolute in the world coordinate system. <span class="command">Sample Size</span> will represent the approximate diamater of a cell, which means that the cell density will appear greater on distant geometry than on geometry that lies nearer.</li><li> <span class="command">Screen</span>: The cell diameter is defined as a fraction of the output size. A value of <span class="command_value">0.1</span> represents 10 cells wide. The cell depth will decline for geometry in the distance.</li></ul><p></p>
<p>This setting is affected by several algorithms, which use other criteria (e.g., very small <span class="command">Sample Size</span> values will produce larger cells and geometry such as spheres will have smaller cells) to dynamically determine the cell size.</p>
<p><a id="GI_SETUP_DATA_LIGHT_MAPPING_PATH_DIRECT" name="GI_SETUP_DATA_LIGHT_MAPPING_PATH_DIRECT"></a> <!--INDEX "8","Direct Lights","GI_SETUP_DATA_LIGHT_MAPPING_PATH_DIRECT"--><span class="c4d_id">Direct Lights</span></p>
<p>Enabling this option will speed up rendering for Projects that have very many real light sources. For GI calculation (and not only for GI), surfaces illuminated by light sources will be placed directly into Light Maps:</p>
<p><div class="image_full" style="max-width:1600px"><img  src="../pics/037321.jpg"  ><span class="caption">Left: <span class="command">Direct Lights</span> disabled; right: enabled. The strip of light is the light emitted by 120 Spot lights.</span></div></p>
<p>The gain in render speed can be quite substantial, depending on the scene (simply put, light source information gathered during Light Map calculation is subsequently re-used by the GI <span class="command">Primary Method</span>). Very good results at moderate render times can be achieved when using QMC+LM.</p>
<p>The following image was rendered using <span class="command">QMC+QMC</span> (Record Density of <span class="command_value">8</span>) on the left, <span class="command">QMC+LM</span> (<span class="command">Direct Lights</span> disabled) at center, and <span class="command">QMC+LM</span> (<span class="command">Direct Lights</span> enabled) at right:</p>
<p><div class="image_full" style="max-width:2400px"><img  src="../pics/037322.jpg"  ><span class="caption">This strip of light is also emitted by 120 Spot lights.</span></div></p>
<p>Note how much faster and better <span class="command">Direct Lights</span> renders. The Light Map’s high Record Density produces a brighter and more realistic image.</p>
<p><a id="GI_SETUP_DATA_LIGHT_MAPPING_PATH_CAMERA" name="GI_SETUP_DATA_LIGHT_MAPPING_PATH_CAMERA"></a> <!--INDEX "8","Use Camera Path","GI_SETUP_DATA_LIGHT_MAPPING_PATH_CAMERA"--><span class="c4d_id">Use Camera Path</span></p>
<p>If this option is enabled, all sample start points will be ascertained for the entire camera movement. This is useful if a camera movement’s start and end frames differ greatly and you have to ensure that the Light Map "sees" all angles of view. A single, unchanged and therewith stable (Light Map)cache will then be used to calculate the animation. If the camera only moves slightly and the angle of view does not change much, this option does not have to be enabled.</p>
<p><p><div class="hint"><span class="HL_hint">Tip:<br></span>This option is only designed for use with camera animations in which nothing else changes except for the camera’s position, i.e., objects and lights are not animated. If the latter is true, then disable <span class="command">Use Camera Path</span> and enable <a href="VPGISETUP-GI_GROUP_CACHES.html#GI_SETUP_DATA_LIGHT_MAPPING_ANIMATION" target="_self"><span class="text_id">Full Animation Mode</span></a> in the <span class="command">Cache Files</span> tab.</div></p>
<p><a id="GI_SETUP_DATA_LIGHT_MAPPING_PATH_SHOW_PATHS" name="GI_SETUP_DATA_LIGHT_MAPPING_PATH_SHOW_PATHS"></a> <!--INDEX "8","Show Preview Paths","GI_SETUP_DATA_LIGHT_MAPPING_PATH_SHOW_PATHS"--><span class="c4d_id">Show Preview Paths</span></p>
<p>This option does not affect the Light Map directly. If enabled, the progress of the samples just calculated will be shown during calculation. These will then be compiled according to <span class="command">Sample Size</span> in a cell and averaged.</p>
<p><a id="GI_SETUP_DATA_LIGHT_MAPPING_RADIANCE" name="GI_SETUP_DATA_LIGHT_MAPPING_RADIANCE"></a> <!--INDEX "8","Build Radiosity Maps","GI_SETUP_DATA_LIGHT_MAPPING_RADIANCE"--><span class="c4d_id">Build Radiosity Maps</span></p>
<p>Enabling this option is like switching on a turbo charger. If enabled, the Light Map will be calculated and it will then be converted to a <a href="VPGISETUP-GI_GROUP_RADIANCE.html" target="">Radiosity-Map</a>, which will be used internally for rendering. This dramatically reduces render time while basically maintaining the same level of quality (both with IR+LM and with QMC+LM).</p>
<p>Disadvantage: Radiosity Maps require a lot of memory for the saved cache on the hard drive as well as RAM. Problems can occur with complex projects. It is therefore recommended that <span class="command">Auto Load</span> and <span class="command">Auto Save</span> not be enabled in the <span class="command">Cache Files</span> tab when working with this type of Radiosity Map. Rendering a Light Map with the right settings is also very fast.</p>
<p><a id="GI_SETUP_DATA_LIGHT_MAPPING_RADIANCE_SCALE" name="GI_SETUP_DATA_LIGHT_MAPPING_RADIANCE_SCALE"></a> <!--INDEX "8","Map Density","GI_SETUP_DATA_LIGHT_MAPPING_RADIANCE_SCALE"--><span class="c4d_id">Map Density</span> <span class="range">[10..1000%]</span></p>
<p>This settting works like the <a href="VPGISETUP-GI_GROUP_RADIANCE.html#GI_SETUP_DATA_RADIANCE_SCALE" target="_self"><span class="text_id">Map Density</span></a> Radiosity Map setting of the same name, but that the sampling is much faster. Simply put, this is where you adjust the texel size.</p>
<p><a id="GI_SETUP_DATA_LIGHT_MAPPING_RADIANCE_SAMPLES" name="GI_SETUP_DATA_LIGHT_MAPPING_RADIANCE_SAMPLES"></a> <!--INDEX "8","Sampling Subdivisions","GI_SETUP_DATA_LIGHT_MAPPING_RADIANCE_SAMPLES"--><span class="c4d_id">Sampling Subdivisions</span> <span class="range">[1..16]</span></p>
<p>This setting works like the <a href="VPGISETUP-GI_GROUP_RADIANCE.html#GI_SETUP_DATA_RADIANCE_SAMPLES" target="_self"><span class="text_id">Sampling Subdivisions</span></a> Radiosity Map setting of the same name, but the sampling is much faster. Simply put, this is where you adjust a type of ,antialiasing’ for the texels.</p>
<p><a id="hl_3" name="hl_3"></a><!--INDEX "3","Making Light Maps homogenous","hl_3"--><p><span class="HL_1">Making Light Maps homogenous</span></p>
<p><div class="image_full" style="max-width:1600px"><img  src="../pics/037326.jpg"  ><span class="caption">Left without, right with Prefilter.</span></div></p>
<p>The Prefilter ensures that a inhomogenous, spotty Light Map (or Radiosity Map) is converted to a more uniform map - before they are used for rendering or one of the following interpolations.</p>
<p>This is done per cell. Depending on the settings, the colors of several neighboring cells will be averaged and then assigned to the cell. This process is calculated very fast and has basically no affect on render time.</p>
<p>Prefilters can reduce flickering in animation especially in conjunction with the <span class="command_value">Irradiance Cache</span> <span class="command">Primary Method</span>. However, note that a type of blurr effect takes place that can swallow details and lead to light leaks (which can be compensated for by improving the <span class="command">Path Count (1000s)</span> and <span class="command">Sample Size</span> settings).</p>
<p><p><div class="hint"><span class="HL_hint">Tip:<br></span>If you want to see the effect of the Prefilter and interpolation methods without rendering, set <span class="command">Mode</span> to <span class="command_value">Visualize</span>.</div></p>
<p><p><div class="hint"><span class="HL_hint">Tip 2:<br></span>Note that both the Prefilter as well as the effect of the interpolation methods are not saved with the cache. These are always calculated anew during rendering, which means that you can quickly test the various "blurry" settings if <span class="command">Auto Load</span> and <span class="command">Auto Save</span> are enabled in the <span class="command">Cache Files</span> tab.</div></p>
<p><a id="GI_SETUP_DATA_LIGHT_MAPPING_PREFILTER" name="GI_SETUP_DATA_LIGHT_MAPPING_PREFILTER"></a> <!--INDEX "8","Prefilter","GI_SETUP_DATA_LIGHT_MAPPING_PREFILTER"--><span class="c4d_id">Prefilter</span></p>
<p>Enables/disables the Prefilter option.</p>
<p><a id="GI_SETUP_DATA_LIGHT_MAPPING_PREFILTER_COUNT" name="GI_SETUP_DATA_LIGHT_MAPPING_PREFILTER_COUNT"></a> <!--INDEX "8","Prefilter Samples","GI_SETUP_DATA_LIGHT_MAPPING_PREFILTER_COUNT"--><span class="c4d_id">Prefilter Samples</span> <span class="range">[1..64]</span></p>
<p><div class="image_full" style="max-width:1600px"><img  src="../pics/037323.jpg"  ><span class="caption">At left a small <span class="command">Prefilter Samples</span> value, at right a larger value. Note that contact shadows and light leaks are present on the right.</span></div></p>
<p>Use this setting to define the size of the radius for the current cell by averaging surrounding cells.</p>
<p>Values that are too large will swallow details and lead to light leaks.</p>
<p><a id="GI_SETUP_DATA_LIGHT_MAPPING_FILTER" name="GI_SETUP_DATA_LIGHT_MAPPING_FILTER"></a> <!--INDEX "8","Interpolation Method","GI_SETUP_DATA_LIGHT_MAPPING_FILTER"--><span class="c4d_id">Interpolation Method</span><br><a id="GI_SETUP_DATA_LIGHT_MAPPING_FILTER_COUNT" name="GI_SETUP_DATA_LIGHT_MAPPING_FILTER_COUNT"></a> <!--INDEX "8","Sample Count","GI_SETUP_DATA_LIGHT_MAPPING_FILTER_COUNT"--><span class="c4d_id">Sample Count</span> <span class="range">[1..256]</span><br><a id="GI_SETUP_DATA_LIGHT_MAPPING_FILTER_SCALE" name="GI_SETUP_DATA_LIGHT_MAPPING_FILTER_SCALE"></a> <!--INDEX "8","Size Ratio","GI_SETUP_DATA_LIGHT_MAPPING_FILTER_SCALE"--><span class="c4d_id">Size Ratio</span> <span class="range">[100..1600%]</span></p>
<p><div class="image_full" style="max-width:1558px"><img  src="../pics/037324.jpg"  ><span class="caption">The pre-filtered Light Map on the left has interpolation added at the right.</span></div></p>
<p>During rendering, the Light Map’s (or Radiosity Map’s) cells are actually interpolated so the cell structure is dissolved if the settings’ values are high enough. This will produce even brightness progressions.</p>
<p>Even better results can be achieved in combination with the Prefilter. However, interpolation requires a corresponding amount of additional render time and correspondingly more light leaks will result with larger interpolations.</p>
<p>There are several methods from which to select for planar interpolation of discontinuous color gradients (cells):<ul></p>
<p><li> <span class="command">None</span>: No interpolation will be made (the calculation is very fast); the occurrance of light leaks will be minimized but the <span class="command">Primary Method</span> for GI will see the cells. Sufficient pre-filtering can help.</li><li> <span class="command">Nearest</span>: A specific number of neighboring samples (defined by <span class="command">Sample Count</span>) is ascertained and their colors are averaged. This is not an absolute value because it also takes into consideration the <a href="VPGISETUP-GI_GROUP_LIGHT_MAPPING.html#GI_SETUP_DATA_LIGHT_MAPPING_PATH_SCALE_SCREEN" target="_self"><span class="text_id">Samples Size</span></a> value, which means that a sample density will reduce the radius in which the samples to be included lie.</li><li> <span class="command">Fixed</span>: In conjunction with the <span class="command">Scale</span> value, a fixed distance around the point to be calculated is ascertained withing which samples are obtained. This method produces the most "blurred" results.</li></ul><p></p>
<p>What these effects look like is shown in the image below (for illustration purposes, Prefilter was not used):</p>
<p><div class="image_full" style="max-width:2366px"><img  src="../pics/037325.jpg"  ><span class="caption">The state the left is prior to interpolation. In the center and at the right various interpolation methods and settings were used.</p>
<p></span></div></p>
<p><a id="GI_SETUP_DATA_LIGHT_MAPPING_MODE" name="GI_SETUP_DATA_LIGHT_MAPPING_MODE"></a> <!--INDEX "8","Mode","GI_SETUP_DATA_LIGHT_MAPPING_MODE"--><span class="c4d_id">Mode</span></p>
<p>Here you can select which Light Map should be displayed: if <span class="command_value">Visualize</span> is selected, the <span class="command">Primary Method</span> for GI will not be calculated - only the <span class="command">Secondary Method</span> will be displayed and calculated. The examples in the previous image were all rendered using this method. This is very well suited for fine-tuning a Light Map prior to rendering.</p>
<p>Otherwise this mode serves to pre-calculate light map caches (without final rendering).</p>
<p><b>The final rendering must ALWAYS be done in <span class="command_value">Normal</span> mode.</b></p>
<p>

</p>
  </div>  </div>
</body>

</html>